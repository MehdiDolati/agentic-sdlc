(.venv) PS D:\AI\agentic-sdlc> pytest -q services/api/tests/
..........................................................F....                                                  [100%]
====================================================== FAILURES =======================================================
__________________________________________ test_ui_plan_detail_and_sections ___________________________________________
  + Exception Group Traceback (most recent call last):
  |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_utils.py", line 77, in collapse_excgroups
  |     yield
  |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\runner.py", line 341, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\runner.py", line 242, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\threadexception.py", line 92, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\threadexception.py", line 68, in thread_exception_runtest_hook
    |     yield
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\unraisableexception.py", line 95, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\unraisableexception.py", line 70, in unraisable_exception_runtest_hook
    |     yield
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\logging.py", line 848, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\logging.py", line 831, in _runtest_for
    |     yield
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\capture.py", line 879, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\skipping.py", line 257, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\runner.py", line 174, in pytest_runtest_call
    |     item.runtest()
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\python.py", line 1627, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\_pytest\python.py", line 159, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\services\api\tests\test_ui.py", line 61, in test_ui_plan_detail_and_sections
    |     r = client.get(f"/ui/plans/{plan_id}/sections/prd", headers={"HX-Request": "true"})
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\testclient.py", line 518, in get
    |     return super().get(
    |            ^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 1054, in get
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\testclient.py", line 488, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 827, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\httpx\_client.py", line 1015, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\testclient.py", line 381, in handle_request
    |     raise exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\testclient.py", line 378, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\from_thread.py", line 291, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Program Files\Python311\Lib\concurrent\futures\_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Program Files\Python311\Lib\concurrent\futures\_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\from_thread.py", line 222, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\errors.py", line 187, in __call__
    |     raise exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |   File "C:\Program Files\Python311\Lib\contextlib.py", line 155, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_utils.py", line 83, in collapse_excgroups
    |     raise exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\services\api\app.py", line 289, in _attach_user_to_request
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    |     raise exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    |     raise exc
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    |     return await run_in_threadpool(dependant.call, **values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func, *args)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2476, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 967, in run
    |     result = context.run(func, *args)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\services\api\ui\plans.py", line 771, in ui_plan_section_prd
    |     return templates.TemplateResponse(request,"section_prd.html", {
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\templating.py", line 209, in TemplateResponse
    |     return _TemplateResponse(
    |            ^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\templating.py", line 40, in __init__
    |     content = template.render(context)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\jinja2\environment.py", line 1295, in render
    |     self.environment.handle_exception()
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\jinja2\environment.py", line 942, in handle_exception
    |     raise rewrite_traceback_stack(source=source)
    |   File "D:\AI\agentic-sdlc\services\templates\section_prd.html", line 6, in top-level template code
    |     <button hx-get="/ui/plans/{{ plan['id'] }}/artifacts/prd/edit" hx-target="closest .card" hx-swap="outerHTML">Edit</button>
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\AI\agentic-sdlc\.venv\Lib\site-packages\jinja2\environment.py", line 471, in getitem
    |     return obj[argument]
    |            ~~~^^^^^^^^^^
    | jinja2.exceptions.UndefinedError: 'plan' is undefined
    +------------------------------------

During handling of the above exception, another exception occurred:

tmp_path = WindowsPath('C:/Users/Mehdi/AppData/Local/Temp/pytest-of-Mehdi/pytest-58/test_ui_plan_detail_and_sectio0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x000001D905898450>

    def test_ui_plan_detail_and_sections(tmp_path: Path, monkeypatch):
        monkeypatch.setenv("PYTEST_CURRENT_TEST", "1")

        app, app_module = _setup_app(tmp_path)
        client = TestClient(app)

        j = _mk_plan(client, "Add search to notes list")
        plan_id = j["plan_id"]

        # Plan detail renders
        r = client.get(f"/ui/plans/{plan_id}")
        assert r.status_code == 200
        assert "Add search to notes list" in r.text
        # PRD section should be present by default
        assert "<h2>PRD</h2>" in r.text

        # HTMX partials render just the section fragment
>       r = client.get(f"/ui/plans/{plan_id}/sections/prd", headers={"HX-Request": "true"})

services\api\tests\test_ui.py:61:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.venv\Lib\site-packages\starlette\testclient.py:518: in get
    return super().get(
.venv\Lib\site-packages\httpx\_client.py:1054: in get
    return self.request(
.venv\Lib\site-packages\starlette\testclient.py:488: in request
    return super().request(
.venv\Lib\site-packages\httpx\_client.py:827: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
.venv\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
.venv\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
.venv\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
.venv\Lib\site-packages\httpx\_client.py:1015: in _send_single_request
    response = transport.handle_request(request)
.venv\Lib\site-packages\starlette\testclient.py:381: in handle_request
    raise exc
.venv\Lib\site-packages\starlette\testclient.py:378: in handle_request
    portal.call(self.app, scope, receive, send)
.venv\Lib\site-packages\anyio\from_thread.py:291: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
C:\Program Files\Python311\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
C:\Program Files\Python311\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:222: in _call_func
    retval = await retval_or_awaitable
.venv\Lib\site-packages\fastapi\applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:187: in __call__
    raise exc
.venv\Lib\site-packages\starlette\middleware\errors.py:165: in __call__
    await self.app(scope, receive, _send)
.venv\Lib\site-packages\starlette\middleware\base.py:185: in __call__
    with collapse_excgroups():
C:\Program Files\Python311\Lib\contextlib.py:155: in __exit__
    self.gen.throw(typ, value, traceback)
.venv\Lib\site-packages\starlette\_utils.py:83: in collapse_excgroups
    raise exc
.venv\Lib\site-packages\starlette\middleware\base.py:187: in __call__
    response = await self.dispatch_func(request, call_next)
services\api\app.py:289: in _attach_user_to_request
    return await call_next(request)
.venv\Lib\site-packages\starlette\middleware\base.py:163: in call_next
    raise app_exc
.venv\Lib\site-packages\starlette\middleware\base.py:149: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv\Lib\site-packages\starlette\_exception_handler.py:62: in wrapped_app
    raise exc
.venv\Lib\site-packages\starlette\_exception_handler.py:51: in wrapped_app
    await app(scope, receive, sender)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:735: in app
    await route.handle(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:288: in handle
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:76: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv\Lib\site-packages\starlette\_exception_handler.py:62: in wrapped_app
    raise exc
.venv\Lib\site-packages\starlette\_exception_handler.py:51: in wrapped_app
    await app(scope, receive, sender)
.venv\Lib\site-packages\starlette\routing.py:73: in app
    response = await f(request)
.venv\Lib\site-packages\fastapi\routing.py:301: in app
    raw_response = await run_endpoint_function(
.venv\Lib\site-packages\fastapi\routing.py:214: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
.venv\Lib\site-packages\starlette\concurrency.py:39: in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
.venv\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
.venv\Lib\site-packages\anyio\_backends\_asyncio.py:2476: in run_sync_in_worker_thread
    return await future
.venv\Lib\site-packages\anyio\_backends\_asyncio.py:967: in run
    result = context.run(func, *args)
services\api\ui\plans.py:771: in ui_plan_section_prd
    return templates.TemplateResponse(request,"section_prd.html", {
.venv\Lib\site-packages\starlette\templating.py:209: in TemplateResponse
    return _TemplateResponse(
.venv\Lib\site-packages\starlette\templating.py:40: in __init__
    content = template.render(context)
.venv\Lib\site-packages\jinja2\environment.py:1295: in render
    self.environment.handle_exception()
.venv\Lib\site-packages\jinja2\environment.py:942: in handle_exception
    raise rewrite_traceback_stack(source=source)
services\templates\section_prd.html:6: in top-level template code
    <button hx-get="/ui/plans/{{ plan['id'] }}/artifacts/prd/edit" hx-target="closest .card" hx-swap="outerHTML">Edit</button>
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <jinja2.environment.Environment object at 0x000001D9057E7850>, obj = Undefined, argument = 'id'

    def getitem(
        self, obj: t.Any, argument: t.Union[str, t.Any]
    ) -> t.Union[t.Any, Undefined]:
        """Get an item or attribute of an object but prefer the item."""
        try:
>           return obj[argument]
E           jinja2.exceptions.UndefinedError: 'plan' is undefined

.venv\Lib\site-packages\jinja2\environment.py:471: UndefinedError
------------------------------------------------ Captured stdout call -------------------------------------------------
[LLM] provider=none â€” using deterministic generators
Writing PRD file at: C:\Users\Mehdi\AppData\Local\Temp\pytest-of-Mehdi\pytest-58\test_ui_plan_detail_and_sectio0\docs\prd\PRD-20250916-add-search-to-notes-list.md
Writing OpenAPI file at: C:\Users\Mehdi\AppData\Local\Temp\pytest-of-Mehdi\pytest-58\test_ui_plan_detail_and_sectio0\docs\api\generated\openapi-20250916-add-search-to-notes-list.yaml
================================================== warnings summary ===================================================
.venv\Lib\site-packages\starlette\formparsers.py:12
  D:\AI\agentic-sdlc\.venv\Lib\site-packages\starlette\formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================================== short test summary info ===============================================
FAILED services/api/tests/test_ui.py::test_ui_plan_detail_and_sections - jinja2.exceptions.UndefinedError: 'plan' is undefined
1 failed, 62 passed, 1 warning in 9.78s
(.venv) PS D:\AI\agentic-sdlc>
