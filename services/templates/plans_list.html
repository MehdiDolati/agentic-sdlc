{% extends "base.html" %}
{% block content %}
<h1>Plans</h1>
<div style="margin-bottom:12px;">
  <a href="/ui/requests/new" class="badge">New Plan</a>
</div>
<div class="card" style="margin-top:12px;">
  <!-- filters -->
<form id="plans-filters"
      class="filters"
      hx-get="/ui/plans"
      hx-target="#plans-table"
      hx-swap="outerHTML"
      hx-select="#plans-table"
      hx-push-url="true">
  <!-- Status -->
  <label>Status:</label>
  <select name="status" onchange="this.form.requestSubmit()">
    <option value="" {{ '' == (status or '') and 'selected' or '' }}>All</option>
    <option value="queued"  {{ status == 'queued'  and 'selected' or '' }}>Queued</option>
    <option value="running" {{ status == 'running' and 'selected' or '' }}>Running</option>
    <option value="success" {{ status == 'success' and 'selected' or '' }}>Success</option>
    <option value="failed"  {{ status == 'failed'  and 'selected' or '' }}>Failed</option>
  </select>

  <!-- Owner (free text keeps it simple & robust) -->
  <label style="margin-left:1rem;">Owner:</label>
  <input type="text" name="owner" value="{{ owner or '' }}" placeholder="owner email/id"
         onkeydown="if(event.key==='Enter'){event.preventDefault(); this.form.requestSubmit();}">
  <button type="button" onclick="this.form.requestSubmit()">Apply</button>

  <!-- Sort -->
  <label style="margin-left:1rem;">Sort by:</label>
  <select name="sort" onchange="this.form.requestSubmit()">
    <option value=""                {{ (sort or '')==''                and 'selected' or '' }}>Default</option>
    <option value="created_at"      {{ sort=='created_at'              and 'selected' or '' }}>Created</option>
    <option value="request"         {{ sort=='request'                 and 'selected' or '' }}>Request</option>
    <option value="owner"           {{ sort=='owner'                   and 'selected' or '' }}>Owner</option>
    <option value="last_run_status" {{ sort=='last_run_status'         and 'selected' or '' }}>Last Run Status</option>
    <option value="last_run_at"     {{ sort=='last_run_at'             and 'selected' or '' }}>Last Run Time</option>
  </select>

  <select name="order" onchange="this.form.requestSubmit()">
    <option value="desc" {{ order=='desc' and 'selected' or '' }}>Desc</option>
    <option value="asc"  {{ order=='asc'  and 'selected' or '' }}>Asc</option>
  </select>

  <!-- keep other query params; reset offset on filter/sort change -->
  <input type="hidden" name="q"     value="{{ q or '' }}">
  <input type="hidden" name="limit" value="{{ limit }}">
  <input type="hidden" name="offset" value="0">
</form>

<!-- stable wrapper that NEVER disappears -->
<div id="plans-table">
  {% include "plans_list_table.html" %}
</div>
{% endblock %}
