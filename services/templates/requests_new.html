<!-- services/templates/requests_new.html -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New Plan Request</title>
    <link href="{{ url_for('static', path='site.css') }}" rel="stylesheet" />
  </head>
  <body>
    <div id="flash"></div>
    <h1>Create a Plan / Request</h1>
    <div id="new-plan">
      <label>Project vision</label><br/>
      <textarea id="project_vision" rows="8" cols="80" required></textarea><br/><br/>

      <label>Agent mode</label>
      <select id="agent_mode">
        {% for m in modes %}
          <option value="{{ m }}" {% if m==default_mode %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>

      <label>LLM provider</label>
      <select id="llm_provider">
        {% for p in providers %}
          <option value="{{ p }}" {% if p==default_provider %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>

      <label>Plan ID (optional)</label>
      <input id="plan_id" type="text" placeholder="e.g. PLAN-001" />

      <div style="margin-top:1rem">
        <button id="submitBtn" type="button">Generate draft</button>
      </div>
    </div>
    <script>
      document.getElementById('submitBtn').addEventListener('click', async () => {
        const body = new URLSearchParams();
        body.set('project_vision', document.getElementById('project_vision').value);
        body.set('agent_mode', document.getElementById('agent_mode').value);
        body.set('llm_provider', document.getElementById('llm_provider').value);
        body.set('plan_id', document.getElementById('plan_id').value);

        // POST to the existing FastAPI handler that expects Form(...)
        const r = await fetch('/ui/requests', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'},
          body: body.toString()
        });
        const html = await r.text();
        // Replace the whole page with the server-rendered review HTML
        document.open(); document.write(html); document.close();
      });
    </script>
  </body>
</html>
