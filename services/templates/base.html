<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ title or "Planner UI" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="{{ url_for('static', path='site.css') }}" rel="stylesheet" />
    <!-- Load HTMX locally to avoid SRI/CDN issues -->
    <script src="{{ url_for('static', path='htmx.min.js') }}" defer></script>
  </head>
  <body>
  <div id="flash" style="display:none"></div>
  <span style="flex:1"></span>
  <nav style="display:inline-block;">
    {% if request.state.user and request.state.user.id != 'public' %}
      <span>Signed in as {{ request.state.user.email }}</span>
      <a href="/ui/logout" style="margin-left:.75rem">Logout</a>
    {% else %}
      <a href="/ui/login">Login</a>
      <a href="/ui/register" style="margin-left:.75rem">Register</a>
    {% endif %}
  </nav>
    <div class="container">
      {% block content %}{% endblock %}
    </div>
  <script>
    // Single fallback for HTMX errors when server didn't send _flash.html
    document.body.addEventListener('htmx:responseError', function (e) {
      var xhr = e.detail.xhr;
      var msg = ((xhr && xhr.responseText) || '').trim() || ('Request failed (' + xhr.status + ')');
      var banner = document.getElementById('flash');
      if (banner) {
        banner.className = 'flash error';
        banner.innerHTML = '<strong>Error</strong><span style="margin-left:.5rem">' + msg + '</span>';
        banner.style.display = '';
      }
    }, { passive: true });
  </script>
  </body>
</html>